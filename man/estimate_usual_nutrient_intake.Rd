% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/estimate_usual_nutrient_intake.R
\name{estimate_usual_nutrient_intake}
\alias{estimate_usual_nutrient_intake}
\title{Estimate Usual Nutrient Intake using NRC method with adaptive repeater policy}
\usage{
estimate_usual_nutrient_intake(
  recall_data,
  id_col,
  nutrient_cols,
  transform = c("cuberoot", "log", "sqrt", "none"),
  jitter = FALSE,
  warn_negative_between = TRUE,
  repeater_policy = c("auto", "strict", "lenient"),
  detailed = FALSE
)
}
\arguments{
\item{recall_data}{A data frame containing repeated 24-hour recall data, with one
row per observation (respondent-day).}

\item{id_col}{Character scalar. The name of the column identifying respondents.
Each unique ID represents one participant who may have one or more recall days.}

\item{nutrient_cols}{Character vector of one or more column names containing
nutrient intake values to be processed (e.g. \code{"Energy.kcal_intake"}, \code{"Protein.g_intake"}).
All must be numeric and non-negative.}

\item{transform}{Transformation applied prior to variance estimation to improve
normality. Options are \code{"cuberoot"} (default), \code{"log"}, \code{"sqrt"}, or \code{"none"}.}

\item{jitter}{Logical; if TRUE, adds a deterministic small numeric offset after
transformation to prevent ties (useful when values are identical after rounding).}

\item{warn_negative_between}{Logical; if TRUE, issues warnings when the estimated
between-person variance component is negative before flooring to zero.}

\item{repeater_policy}{Character scalar specifying how strictly to enforce the
minimum amount of replicate information:
\itemize{
\item \code{"auto"} – chooses a balanced adaptive rule based on available replicate
information (default).
\item \code{"strict"} – enforces higher thresholds for replicate data before adjusting.
\item \code{"lenient"} – proceeds with adjustment even when replicate information is limited.
}}

\item{detailed}{Logical; if TRUE, includes diagnostic columns such as observed mean,
between- and within-person standard deviations, degrees of freedom, replicate
count, and shrinkage ratio.}
}
\value{
A tibble containing one row per respondent and estimated usual intakes
for each nutrient. If \code{detailed = TRUE}, additional columns include:
\itemize{
\item \verb{*_observed_mean} – back-transformed observed mean intake.
\item \verb{*_sd_between}, \verb{*_sd_observed} – variance components.
\item \verb{*_df_resid}, \verb{*_R} – residual degrees of freedom and total replicate info.
\item \verb{*_shrink_ratio} – the shrinkage factor applied.
}
}
\description{
Estimates usual nutrient intake distributions from 24-hour recall data following
the NRC/IOM methodology (see \doi{10.17226/10666}). The method adjusts observed
intakes for within-person variability using variance-component shrinkage based
on respondents with repeated recalls. It is flexible and adaptive to different
replicate data quality scenarios through the \code{repeater_policy} argument.
}
\details{
This function implements the NRC (1986) / IOM (2003) recommended approach for
adjusting observed 24-hour recall data to estimate the distribution of \emph{usual}
nutrient intakes within a population. The workflow is:
\enumerate{
\item Apply the chosen transformation (\code{transform}).
\item Identify individuals with ≥2 recall days (repeaters).
\item Estimate within- and between-person variance using ANOVA among repeaters.
\item Derive shrinkage ratio = SD(between) / SD(observed).
\item Shrink each individual's mean intake toward the population mean, adjusting
for the ratio of within-to-between variation.
\item Back-transform to original units.
}

When no repeaters are available, observed means are returned unchanged.
If insufficient replicate information exists, the behaviour depends on \code{repeater_policy}.

When the estimated between-person variance is non-identifiable (≤ 0),
the NRC adjustment is skipped and observed mean intakes are returned with a warning.
}
\examples{
# Example with Energy and Protein
df <- tibble::tibble(
  id = c(1, 1, 2, 2, 3),
  Energy.kcal_intake = c(1800, 2200, 1500, 1600, 2000),
  Protein.g_intake = c(55, 65, 40, 42, 50)
)

estimate_usual_nutrient_intake(
  recall_data = df,
  id_col = "id",
  nutrient_cols = c("Energy.kcal_intake", "Protein.g_intake"),
  transform = "cuberoot"
)

}
\references{
Institute of Medicine (2003). \emph{Dietary Reference Intakes: Applications in Dietary Planning.}
Washington (DC): National Academies Press. Appendix E.
(\url{https://www.ncbi.nlm.nih.gov/books/NBK221370/})
}
